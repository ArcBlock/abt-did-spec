</<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <article class="markdown-body entry-content" itemprop="text"><h2><a id="user-content-did-auth-protocol" class="anchor" aria-hidden="true" href="#did-auth-protocol"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DID-Auth-Protocol</h2>
    <p>This repository defines the specification of ArcBlock DID Auth Protocol.</p>
    <h2><a id="user-content-table-of-contents" class="anchor" aria-hidden="true" href="#table-of-contents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table of Contents</h2>
    <ul>
    <li><a href="#did-auth-protocol">DID-Auth-Protocol</a></li>
    <li><a href="#table-of-contents">Table of Contents</a></li>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#workflow">Workflow</a>
    <ul>
    <li><a href="#pre-knowledge">Pre-knowledge:</a></li>
    <li><a href="#request-did-authentication">Request DID Authentication</a></li>
    <li><a href="#response-did-authentication">Response DID Authentication</a></li>
    <li><a href="#revoke-did-authentication">Revoke DID Authentication</a></li>
    </ul>
    </li>
    <li><a href="#did">DID</a>
    <ul>
    <li><a href="#did-type">DID Type</a></li>
    <li><a href="#how-to-create-did">How to create DID</a></li>
    </ul>
    </li>
    <li><a href="#verifiable-claims">Verifiable Claims</a>
    <ul>
    <li><a href="#profile">Profile</a>
    <ul>
    <li><a href="#predefined-claim-items">Predefined claim items:</a></li>
    </ul>
    </li>
    <li><a href="#agreement">Agreement</a></li>
    <li><a href="#proof-of-holding">Proof of Holding</a></li>
    </ul>
    </li>
    <li><a href="#use-cases">Use Cases</a></li>
    <li><a href="#registry-blockchain-tbd">Registry Blockchain (TBD)</a>
    <ul>
    <li><a href="#trust-level">Trust level</a></li>
    </ul>
    </li>
    <li><a href="#apis">APIs</a>
    <ul>
    <li><a href="#wallet-apis">Wallet APIs</a></li>
    <li><a href="#registry-blockchain-side-apis">Registry blockchain side APIs</a></li>
    <li><a href="#forgesdk">ForgeSDK</a></li>
    </ul>
    </li>
    <li><a href="#references">References:</a></li>
    </ul>
    <h2><a id="user-content-abstract" class="anchor" aria-hidden="true" href="#abstract"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Abstract</h2>
    <p>ArcBlock DID (decentralized identification) Authentication Protocol is an open protocol that provides a secure decentralized authentication mechanism by using asymmetric cryptography technology. This protocol involves tree parties, wallet (the client side agent of the end user), application (the service provider) and ABT chain (the decentralized trust authority). In this protocol we define authentication as the process that the prover proves to the verifier that he or she is in possesses of the secret key of a certain public key. The public key then serves as a bridge which binds the prover with verifier's business logic.</p>
    <h2><a id="user-content-motivation" class="anchor" aria-hidden="true" href="#motivation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
    <h2><a id="user-content-workflow" class="anchor" aria-hidden="true" href="#workflow"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Workflow</h2>
    <p>The entire authentication protocol contains three process: Pre-knowledge, Request DID Authentication and Response DID Authentication. We will illustrate each one of them in detail in this section.</p>
    <h3><a id="user-content-pre-knowledge" class="anchor" aria-hidden="true" href="#pre-knowledge"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-knowledge:</h3>
    <p>Pre-knowledge refers that process that wallet gets the information of an application before the real authentication starts. Wallet needs to know the application's DID, application's public key and its service endpoint in advance. This information could be contained in a QR code or a deep link provided by the application.</p>
    <p>The following is an example of the QR code content or a deep link.</p>
    <pre><code>https://arcwallet.io/i?appPk=zBdZEnbDJTijVVCx4Nx68bzDPPMFwVizSRorvzSS3SGG2&amp;appDid=did:abt:zNK7PeUtemp5oAhJ4zNmGJ8rUoFnB1CtKfoU&amp;action=requestAuth&amp;url=https://example-application.io/auth/
    </code></pre>
    <ul>
    <li><code>linkPath</code>: The <code>linkPath</code> is located at the beginning of the link, <code>https://arcwallet.io/i</code> in this example, and is used to locate the wallet. This part is configurable and the SDK allows developer to register their own domain for application.
    <ul>
    <li>If the QR code is scanned by a third part camera, e.g. iPhone, wallet should be open and the parameters will be passed to wallet if it is installed. If wallet is not installed, an installation page should be open. The same behavior applies to the case when the user clicks such link. The process illustrated above depends on the deep link technology on different platforms such as <a href="https://developer.apple.com/ios/universal-links/" rel="nofollow">iOS</a> and <a href="https://developer.android.com/training/app-links/" rel="nofollow">Android</a>.</li>
    <li>If the QR code is scanned by the wallet, this section will be ignored and the parameters will be parsed.</li>
    </ul>
    </li>
    <li><code>appPk</code>: This parameter is Bitcoin Base58 encoded public key of application. It will be passed to ArcWallet.</li>
    <li><code>appDid</code>: This is the application's DID.</li>
    <li><code>action</code>: Tells the action that wallet should perform in next step. Here the action should be <code>requestAuth</code> and the wallet will use <code>GET</code> method to access the <code>url</code></li>
    <li><code>url</code>: This parameter is the <a href="https://en.wikipedia.org/wiki/Percent-encoding#The_application.2Fx-www-form-urlencoded_type" rel="nofollow">x-www-form-urlencoded</a> URL that will be used by wallet to start the Request DID Authentication process latter.</li>
    </ul>
    <h3><a id="user-content-request-did-authentication" class="anchor" aria-hidden="true" href="#request-did-authentication"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request DID Authentication</h3>
    <p>After the wallet gathers the information described in previous section it starts the Request DID Authentication process. The main purpose of this process is to acquire the verifiable claims requested by application.</p>
    <ol>
    <li>
    <p>First, wallet must calculate a <code>userDid</code> for this application. This is intend to protect the user's privacy. We use BIP44 to calculate this <code>userDid</code>:</p>
    <ol>
    <li>Apply sha3 to the appDid</li>
    <li>Take the first 64 bits of the hash</li>
    <li>Split the these 64 bits into two 32-bits-long sections denoted as <code>S1</code> and <code>S2</code>.</li>
    <li>Derive the HD secret key by using path <code>m/44'/ABT'/S1'/S2'/address_index</code> where ABT' is the coin type registered on SLIP44 and address_index is numbered from index 0 in sequentially increasing manner.</li>
    <li>Convert the HD secret key to <code>userDid</code> by using the rules described in <a href="#did">DID section</a>.</li>
    <li>From this point, the wallet should use this derived secret key, public key and DID for future processing.</li>
    </ol>
    </li>
    <li>
    <p>Encrypt the <code>userDid</code> with <code>appPk</code>. (TBD)</p>
    </li>
    <li>
    <p>Wallet sends the encrypted <code>userDid</code> to the application's requestAuth endpoint.</p>
    <pre><code>GET https://example-application.io/auth?userDid=encrypted_userDid
    </code></pre>
    </li>
    <li>
    <p>The response returned by application should contain two fields <code>appPk</code> and <code>authInfo</code>.</p>
    <ul>
    <li><code>appPk</code> is the application's public key, encoded by Bitcoin Base58.</li>
    <li><code>authInfo</code> is a signed object in JWT format.</li>
    </ul>
    <p>The following is an example response payload.</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>appPk<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>zBdZEnbDJTijVVCx4Nx68bzDPPMFwVizSRorvzSS3SGG2<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>authInfo<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>eyJhbGciOiJFZDI1NTE5IiwidHlwIjoiSldUIn0.eyJleHAiOjE1NDg4MDM0MjIsImlhdCI6MTU0ODcwMzQyMiwiaXNzIjoiZGlkOmFidDp6Tkt0Q05xWVdMWVdZVzNnV1JBMXZuUnlrZkNCWllIWnZ6S3IiLCJuYmYiOjE1NDg3MDM0MjIsInJlcXVlc3RlZENsYWltcyI6eyJkb2N1bWVudHMiOlt7Imhhc2giOiJUaGUgaGFzaCBvZiB0aGUgZG9jdW1lbnQncyBjb250ZW50IiwidXJpIjoiaHR0cHM6Ly9kb2N1bWVudC0xLmlvIn0seyJoYXNoIjoiVGhlIGhhc2ggb2YgdGhlIGRvY3VtZW50J3MgY29udGVudCIsInVyaSI6ImlwZnM6Ly9kb2N1bWVudC0yIn1dLCJwcm9maWxlIjpbImZ1bGxOYW1lIiwicGhvbmUiLCJzaGlwcGluZ0FkZHJlc3MiXSwicHJvb2ZPZkhvbGRpbmciOlt7InRva2VuIjoidG9rZW4gbmFtZSAxIiwidmFsdWUiOjE4MDAwMDB9LHsidG9rZW4iOiJ0b2tlbiBuYW1lIDIiLCJ2YWx1ZSI6MTAwMDAwMH1dfSwicmVzcG9uc2VBdXRoVXJpIjoiaHR0cHM6Ly9leGFtcGxlLWFwcGxpY2F0aW9uL3Jlc3BvbnNlLWF1dGgifQ.RasZv6ydSxOBj3H726P8THeo4K4IAd7wapqrdE4hrOVRONByAHYK1kr7uAXASc_-Mw9ShD3IcqAuwnLiEkvHCQ<span class="pl-pds">"</span></span>
    }</pre></div>
    <p>The header and body part of <code>authInfo</code> displayed above decodes as</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>alg<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Ed25519<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>typ<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>JWT<span class="pl-pds">"</span></span>
    }
    {
      <span class="pl-s"><span class="pl-pds">"</span>iss<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>did:abt:zNKtCNqYWLYWYW3gWRA1vnRykfCBZYHZvzKr<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>iat<span class="pl-pds">"</span></span>: <span class="pl-c1">1548703422</span>,
      <span class="pl-s"><span class="pl-pds">"</span>nbf<span class="pl-pds">"</span></span>: <span class="pl-c1">1548703422</span>,
      <span class="pl-s"><span class="pl-pds">"</span>exp<span class="pl-pds">"</span></span>: <span class="pl-c1">1548803422</span>,
      <span class="pl-s"><span class="pl-pds">"</span>appInfo<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The name of the application<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The description of the application.<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>logo<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://example-application/logo<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>action<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>responseAuth<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://example-application/auth<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>profile<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Please fill in basic information.<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>items<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>fullName<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mobilePhone<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mailingAddress<span class="pl-pds">"</span></span>]
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The user data usage agreement.<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://document-1.io<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha256<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          }
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The service agreement<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ipfs://document-2<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha3<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          }
        }
      ]
    }</pre></div>
    </li>
    </ol>
    <ul>
    <li><code>iss</code>: The application's DID generated from <code>appPk</code></li>
    <li><code>iat</code>, <code>nbf</code> and <code>exp</code>: Follow the JWT standard.</li>
    <li><code>appInfo</code>:</li>
    <li><code>url</code>: A must-have field that will be used by wallet in Response DID Authentication process.</li>
    <li><code>action</code>: Tells what action should the wallet perform in next step. Here it should be <code>responseAuth</code> and wallet will use <code>POST</code> method to access the <code>url</code>.</li>
    <li><code>requestedClaims</code> is an optional filed. If the user is unknown to the application, it can ask users to identify themselves by returning this filed. We will illustrate the details of this filed in section <a href="#verifiable-claims">Verifiable Claims</a>. The application can also skip this omit this filed if it wants.</li>
    </ul>
    <ol start="5">
    <li>After gets the response, wallet should do following verifications:</li>
    <li>Verifies if the <code>iat</code> is later than the request is sent.</li>
    <li>Verifies if the response has expired by using <code>exp</code>.</li>
    <li>Verifies if the signature matches the <code>appPk</code> and if the <code>appPk</code> matches the appDid in the <code>iss</code> field.</li>
    <li><strong>(TBD)</strong> The wallet could (may under users' request) ask a registry blockchain for the metadata of the application, <code>trustLevel</code> for example. ArcBlock provides ABT chain as a registry chain.</li>
    <li><strong>(TBD)</strong> The <code>trustLevel</code> can be used by wallet when displaying requested claims to user. For the application whose <code>appDid</code> cannot be found on registry blockchain, wallet should make the entire page with �high risk mark. If an application is asking verifiable claims whose required trust_level is higher than the <code>appDid</code>s', wallet should display those claims with high risk mark.</li>
    </ol>
    <h3><a id="user-content-response-did-authentication" class="anchor" aria-hidden="true" href="#response-did-authentication"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response DID Authentication</h3>
    <p>This is the last process of the overall workflow. Depends on whether application requires verifiable claims, wallet will either prompt user to fill in requested claims and then go to the responseAuth endpoint or go to the endpoint directly in this process.</p>
    <ol>
    <li>
    <p>Wallet should display all requested claims to users and wait for user's input.</p>
    </li>
    <li>
    <p>After user fills all data, wallet signs the payload with the corresponding secret key of the <code>usr_did</code> and then send it back to the <code>url</code> obtained in Request DID Authentication process in following format.</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>userPk<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>userInfo<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    }</pre></div>
    <p>The above <code>userInfo</code> decodes as</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>alg<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Ed25519<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>typ<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>JWT<span class="pl-pds">"</span></span>
    }
    {
      <span class="pl-s"><span class="pl-pds">"</span>iss<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>userDid<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>iat<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548713422<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>nbf<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548713422<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>exp<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548813422<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>profile<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>fullName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Alice Bean<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>mobilePhone<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>123456789<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>mailingAddress<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>addressLine1<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>456 123th AVE<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>addressLine2<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Apt 106<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Redmond<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>state<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>WA<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>postalCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>98052<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>country<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>USA<span class="pl-pds">"</span></span>
          }
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://document-1.io<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha256<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>agreed<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
          <span class="pl-s"><span class="pl-pds">"</span>sig<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>user's signature against the doc hash plus AGREED.<span class="pl-pds">"</span></span>
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ipfs://document-2<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha3<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>agreed<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        }
      ]
    }</pre></div>
    </li>
    <li>
    <p>If the application accepts the authentication request, it responses</p>
    <pre><code>{
      "appPk": "E4852B7091317E3622068E62A5127D1FB0D4AE2FC50213295E10652D2F0ABFC7",
      "jwt": "eyJhbGciOiJFZDI1NTE5IiwidHlwIjoiSldUIn0.eyJleHAiOiIxNTQ4ODk4ODM5IiwiaWF0IjoiMTU0ODg5NzAzOSIsImlzcyI6ImRpZDphYnQ6ek5LdENOcVlXTFlXWVczZ1dSQTF2blJ5a2ZDQlpZSFp2ektyIiwibmJmIjoiMTU0ODg5NzAzOSJ9.OtJDYOLEF_AtBD6qikE-zg-qnzrJnq1OQ2A9dgiLcWxWNZJjEQdUgei-ZfAB3QJ7zPFLxf-m33TS34WJ6cpbCg"
    }

    </code></pre>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>alg<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Ed25519<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>typ<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>JWT<span class="pl-pds">"</span></span>
    }
    {
      <span class="pl-s"><span class="pl-pds">"</span>exp<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548898839<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>iat<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548897039<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>iss<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>did:abt:zNKtCNqYWLYWYW3gWRA1vnRykfCBZYHZvzKr<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>nbf<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1548897039<span class="pl-pds">"</span></span>
    }</pre></div>
    </li>
    <li>
    <p>The JWT returned in step 9 should be included in header of latter requests as <code>Authentication</code> filed.</p>
    </li>
    <li>
    <p>At this point, the authentication process is done.</p>
    </li>
    </ol>
    <h3><a id="user-content-revoke-did-authentication" class="anchor" aria-hidden="true" href="#revoke-did-authentication"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Revoke DID Authentication</h3>
    <p>TBD</p>
    <h2><a id="user-content-did" class="anchor" aria-hidden="true" href="#did"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DID</h2>
    <p>The decentralized identification provided by ArcBlock.</p>
    <pre><code>    did:abt:z1muQ3xqHQK2uiACHyChikobsiY5kLqtShA
          DID            DID string
        schema
    </code></pre>
    <h3><a id="user-content-did-type" class="anchor" aria-hidden="true" href="#did-type"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DID Type</h3>
    <p>DID type is the first two bytes of the DID string's binary format. It contains three sections:</p>
    <ol>
    <li>The first six bits is the <em>RoleType</em> of DID.
    <ul>
    <li><code>account</code> = 0</li>
    <li><code>node</code> = 1</li>
    <li><code>device</code> = 2</li>
    <li><code>application</code> = 3</li>
    <li><code>smart_contract</code> = 4</li>
    <li><code>bot</code> = 5</li>
    <li><code>asset</code> = 6</li>
    <li><code>stake</code> = 7</li>
    <li><code>validator</code> = 8</li>
    <li><code>group</code> = 9</li>
    <li><code>any</code> = 63</li>
    </ul>
    </li>
    <li>The following 5 bits denotes the <em>KeyType</em>, algorithm to convert secret key to public key.
    <ul>
    <li><code>ED25519</code> = 0</li>
    <li><code>SECP256K1</code> = 1</li>
    </ul>
    </li>
    <li>The latter 5 bits represents the <em>Hash</em> function to calculate the hash of public key.
    <ul>
    <li><code>keccak</code> = 0</li>
    <li><code>sha3</code> = 1</li>
    <li><code>keccak_384</code> = 2</li>
    <li><code>sha3_384</code> = 3</li>
    <li><code>keccak_512 </code> = 4</li>
    <li><code>sha3_512 </code> = 5</li>
    </ul>
    </li>
    </ol>
    <p>So DID type bytes <code>0x0C01</code> can be interpreted as follow:</p>
    <pre><code>+-------------+-----------+------------+
    | 000011      | 0000      | 00001      |
    +-------------+-----------+------------+
    | application | ed25519   | sha3       |
    +-------------+-----------+------------+
    </code></pre>
    <h3><a id="user-content-how-to-create-did" class="anchor" aria-hidden="true" href="#how-to-create-did"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to create DID</h3>
    <p>This process is inspired by Bitcoin. The difference is that we use a single SHA3 to replace SHA256 and RIPEMD160 which are used to do double hash in Bitcoin.</p>
    <ul>
    <li>Step 1: Choose the <em>RoleType</em>, <em>KeyType</em> and <em>Hash</em> from above, let's use <code>application</code>, <code>ed25519</code> and <code>sha3</code> in this example.</li>
    <li>Step 2: Choose a secret key randomly, e.g.
    <pre><code>D67C071B6F51D2B61180B9B1AA9BE0DD0704619F0E30453AB4A592B036EDE644E4852B7091317E3622068E62A5127D1FB0D4AE2FC50213295E10652D2F0ABFC7
    </code></pre>
    </li>
    <li>Step 3: Generate the public key of this secret key by using the <em>KeyType</em>. So we can get public key
    <pre><code>E4852B7091317E3622068E62A5127D1FB0D4AE2FC50213295E10652D2F0ABFC7
    </code></pre>
    </li>
    <li>Step 4: Get the <em>Hash</em> of the public key
    <pre><code>EC8E681514753FE5955D3E8B57DAEC9D123E3DB146BDDFC3787163F77F057C27
    </code></pre>
    </li>
    <li>Step 5: Take the first 20 bytes of the public key hash
    <pre><code>EC8E681514753FE5955D3E8B57DAEC9D123E3DB1
    </code></pre>
    </li>
    <li>Step 6: Add the DID type bytes <code>0x0C01</code> in front of the hash of Step 4
    <pre><code>0C01EC8E681514753FE5955D3E8B57DAEC9D123E3DB1
    </code></pre>
    </li>
    <li>Step 7: Get the hash of the extended hash in Step 6
    <pre><code>42CD815145538F8003586C880AF94418341F9C4B8FA0394876553F8A952C7D03
    </code></pre>
    </li>
    <li>Step 8: Take the first 4 bytes in step 7
    <pre><code>42CD8151
    </code></pre>
    </li>
    <li>Step 9: Append the 4 bytes in step 8 to the extended hash in step 6. This is the binary DID string
    <pre><code>0C01EC8E681514753FE5955D3E8B57DAEC9D123E3DB142CD8151
    </code></pre>
    </li>
    <li>Step 10: Encode the binary value by using the Bitcoin Base58 method.
    <pre><code>zNKtCNqYWLYWYW3gWRA1vnRykfCBZYHZvzKr
    </code></pre>
    </li>
    <li>Step 11: Assemble the parts and get the full DID
    <pre><code>did:abt:zNKtCNqYWLYWYW3gWRA1vnRykfCBZYHZvzKr
    </code></pre>
    </li>
    </ul>
    <h2><a id="user-content-verifiable-claims" class="anchor" aria-hidden="true" href="#verifiable-claims"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verifiable Claims</h2>
    <p>Verifiable claims is a list of claim item. Each claim item must have a <code>type</code> filed and can optionally have a <code>meta</code> filed.</p>
    <p>There are three types of verifiable claims so far.</p>
    <ul>
    <li><code>profile</code>: A profile can contain multiple well-known predefined claim items, such as <code>firstName</code>, <code>birthday</code> and so on.</li>
    <li><code>agreement</code>: A peer can ask the users to sign agreements.</li>
    <li><code>proofOfHolding</code>: A peer can require users to prove that they own a certain amount of token or own a certificate issued by a third party.</li>
    </ul>
    <p>The <code>meta</code> is an optional filed that could contain but is not limited to following fields:</p>
    <ul>
    <li><code>description</code>: Used to describe the claim. Wallet can display this field to users.</li>
    </ul>
    <h3><a id="user-content-profile" class="anchor" aria-hidden="true" href="#profile"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Profile</h3>
    <p>Profile is the simplest verifiable claims used to gather users' basic information. A <code>profile</code> cliam type should have following fields:</p>
    <ul>
    <li><code>type</code>: fixed to "profile".</li>
    <li><code>meta</code>: optional field.</li>
    <li><code>items</code>: A list of predefined profile items.</li>
    </ul>
    <p>When peer requires profile claims, it should add a list of profile items to the response:</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>profile<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Please provide the basic information.<span class="pl-pds">"</span></span>,
          },
          <span class="pl-s"><span class="pl-pds">"</span>items<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>fullName<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mobilePhone<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mailingAddress<span class="pl-pds">"</span></span>]
        }
      ]
    }</pre></div>
    <p>After receive this response, the wallet should prompt user to fill in data. Latter, the wallet should return the claims in following format.</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>profile<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Please provide the basic information<span class="pl-pds">"</span></span>,
          },
          <span class="pl-s"><span class="pl-pds">"</span>fullName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Alice Bean<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>mobilePhone<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>123456789<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>mailingAddress<span class="pl-pds">"</span></span>: {
              <span class="pl-s"><span class="pl-pds">"</span>addressLine1<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>456 123th AVE<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>addressLine2<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Apt 106<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Redmond<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>state<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>WA<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>postalCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>98052<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>country<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>USA<span class="pl-pds">"</span></span>
            }
        }
      ]
    }</pre></div>
    <h4><a id="user-content-predefined-claim-items" class="anchor" aria-hidden="true" href="#predefined-claim-items"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Predefined claim items:</h4>
    <ul>
    <li><code>billingAddress</code></li>
    <li><code>birthday</code></li>
    <li><code>companyAddress</code></li>
    <li><code>companyName</code></li>
    <li><code>driverLicense</code></li>
    <li><code>firstName</code></li>
    <li><code>fullName</code></li>
    <li><code>gender</code></li>
    <li><code>highestEducationDegree</code></li>
    <li><code>homeAddress</code></li>
    <li><code>homePhone</code></li>
    <li><code>languages</code></li>
    <li><code>lastName</code></li>
    <li><code>locale</code></li>
    <li><code>mailingAddress</code></li>
    <li><code>maritalStatus</code></li>
    <li><code>middleName</code></li>
    <li><code>mobilePhone</code></li>
    <li><code>nationalId</code></li>
    <li><code>nationality</code></li>
    <li><code>passport</code></li>
    <li><code>personalEmail</code></li>
    <li><code>photo</code></li>
    <li><code>placeOfBirth</code></li>
    <li><code>primaryOccupation</code></li>
    <li><code>socialSecurityNumber</code></li>
    <li><code>taxpayerIdNumber</code></li>
    <li><code>timezone</code></li>
    <li><code>workEmail</code></li>
    <li><code>workPhone</code></li>
    </ul>
    <h3><a id="user-content-agreement" class="anchor" aria-hidden="true" href="#agreement"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Agreement</h3>
    <p>Agreement is another commonly used type of claim. It stands for the agreements that a peer asks the user to sign. An <code>agreement</code> claim type should contain following fields:</p>
    <ul>
    <li><code>type</code>: fixed to "agreement"</li>
    <li><code>meta</code>: optional field.</li>
    <li><code>uri</code>: An URI points to the content of the agreement.</li>
    <li><code>hash</code>: An object where <code>method</code> sub field specifies the algorithm (sha3, sha256 and so on) used, and <code>digest</code> sub field is the hash result.</li>
    <li><code>agreed</code>: A boolean value added by wallet to indicate if the user agrees the agreement.</li>
    <li><code>sig</code>: The DSA signature of the <code>hash</code>.</li>
    </ul>
    <p>When a peer wants a user to sign agreements, it should add a list of claim item of agreement type in the response. Each claim item has a <code>meta</code> containing the URI of the agreement and also a digest of the agreement content.</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The user data usage agreement.<span class="pl-pds">"</span></span>,
          },
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://document-1.io<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha256<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          }
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The service agreement<span class="pl-pds">"</span></span>,
          },
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ipfs://document-2<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha3<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          }
        }
      ]
    }</pre></div>
    <p>When see this response, the wallet should prompt user to sign the agreements. Latter, the wallet should submit a list of signed claim item back to peer. If the user agrees, then wallet shall add <code>response</code> field with <code>AGREED</code> and also a <code>sig</code> field containing the signature of the user. If the user declines, then wallet just need to add <code>response</code> field with <code>DECLINED</code>. No signature is required in this situation.</p>
    <div class="highlight highlight-source-json"><pre>{
      <span class="pl-s"><span class="pl-pds">"</span>requestedClaims<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>https://document-1.io<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha256<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>agreed<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
          <span class="pl-s"><span class="pl-pds">"</span>sig<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>user's signature against the doc digest plus AGREED.<span class="pl-pds">"</span></span>
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agreement<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ipfs://document-2<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>method<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha3<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>digest<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The hash result of the document's content<span class="pl-pds">"</span></span>
          },
          <span class="pl-s"><span class="pl-pds">"</span>agreed<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        }
      ]
    }</pre></div>
    <h3><a id="user-content-proof-of-holding" class="anchor" aria-hidden="true" href="#proof-of-holding"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Proof of Holding</h3>
    <p>TBD</p>
    <h2><a id="user-content-use-cases" class="anchor" aria-hidden="true" href="#use-cases"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use Cases</h2>
    <p>The ABT DID Authentication protocol is a generic peer-to-peer protocol that can be used in any case where authentication is required. It can be used in but is not limited to following scenarios:</p>
    <ul>
    <li>User registration.</li>
    <li>User logon.</li>
    <li>Signing documents.</li>
    <li>Requesting/issuing certificate.</li>
    <li>Applying for VISA.</li>
    <li>Peer-to-peer information exchange.</li>
    </ul>
    <h2><a id="user-content-registry-blockchain-tbd" class="anchor" aria-hidden="true" href="#registry-blockchain-tbd"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Registry Blockchain (TBD)</h2>
    <p>Registry blockchain is the place where application DID should be registered. It is the decentralized authority providing guidance to wallets whether or not the application it is asking for is trustworthy. A registry blockchain should provide at least following information of an application: <code>trustLevel</code>.</p>
    <h4><a id="user-content-trust-level" class="anchor" aria-hidden="true" href="#trust-level"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trust level</h4>
    <p>Trust level is a number to relatively show how trustworthy an application is. The registry blockchain is responsible for maintaining the trust level of an application. For example, an application can stake ABT token on ABT chain to increase its trust level. If the application did something evil, it will be punished and its trust level will drop through voting.</p>
    <h2><a id="user-content-apis" class="anchor" aria-hidden="true" href="#apis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>APIs</h2>
    <h4><a id="user-content-wallet-apis" class="anchor" aria-hidden="true" href="#wallet-apis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wallet APIs</h4>
    <ul>
    <li>Calculates the userDid for this appDid.
    <pre><code>cal_userDid(root_user_sk, appDid) returns userDid
    </code></pre>
    </li>
    </ul>
    <h4><a id="user-content-registry-blockchain-side-apis" class="anchor" aria-hidden="true" href="#registry-blockchain-side-apis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Registry blockchain side APIs</h4>
    <ul>
    <li>The function called by wallet to get the metadata of <code>appDid</code>
    <pre><code>getAppInfo(appDid) returns {trust_level, app_info}
    </code></pre>
    </li>
    </ul>
    <h4><a id="user-content-forgesdk" class="anchor" aria-hidden="true" href="#forgesdk"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ForgeSDK</h4>
    <ul>
    <li>Helper function to construct the encoded challenge to be signed.
    <pre><code>construct_challenge(alg, appDid, nbf, exp, iat, callback, claims \\ []) returns  challenge
    </code></pre>
    </li>
    <li>Helper function to verify the signature and DID of a challenge.
    <pre><code>verify_challenge(challenge, pk)
    verify_did(pk, did)
    </code></pre>
    </li>
    </ul>
    <h2><a id="user-content-references" class="anchor" aria-hidden="true" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References:</h2>
    <ul>
    <li><a href="https://developer.apple.com/ios/universal-links/" rel="nofollow">iOS Universal Link</a></li>
    <li><a href="https://developer.android.com/training/app-links/" rel="nofollow">Android App Link</a></li>
    <li><a href="https://www.w3.org/TR/html5/sec-forms.html#urlencoded-form-data" rel="nofollow">URL Encoded Form Data</a></li>
    <li><a href="https://tools.ietf.org/html/rfc7519" rel="nofollow">JWT</a></li>
    </ul>
    </article>
  </body>
</html>
